var Modal=(function(){var trigger=$('.modal__trigger');var modals=$('.modal');var dialog=$('.modal__dialog');var modalsbg=$('.modal__bg');var content=$('.modal__content');var closers=$('.close-btn');var w=window;var isOpen=false;var contentDelay=400;var len=trigger.length;var getId=function(event){event.preventDefault();var self=this;var modalId=self.dataset.modal;var len=modalId.length;var modalIdTrimmed=modalId.substring(1,len);var modal=document.getElementById(modalIdTrimmed);makeDiv(self,modal);};var makeDiv=function(self,modal){var fakediv=document.getElementById('modal__temp');if(fakediv===null){var div=document.createElement('div');div.id='modal__temp';self.appendChild(div);moveTrig(self,modal,div);}};var moveTrig=function(trig,modal,div){var trigProps=trig.getBoundingClientRect();var m=modal;var mProps=m.querySelector('.modal__content').getBoundingClientRect();var transX,transY,scaleX,scaleY;var xc=w.innerWidth/2;var yc=w.innerHeight/2;trig.classList.add('modal__trigger--active');scaleX=mProps.width/trigProps.width;scaleY=mProps.height/trigProps.height;scaleX=scaleX.toFixed(3);scaleY=scaleY.toFixed(3);transX=Math.round(xc-trigProps.left-trigProps.width/2);transY=Math.round(yc-trigProps.top-trigProps.height/2);if(m.classList.contains('modal--align-top')){transY=Math.round(mProps.height/2+mProps.top-trigProps.top-trigProps.height/2);}trig.style.transform='translate('+transX+'px, '+transY+'px)';trig.style.webkitTransform='translate('+transX+'px, '+transY+'px)';div.style.transform='scale('+scaleX+','+scaleY+')';div.style.webkitTransform='scale('+scaleX+','+scaleY+')';window.setTimeout(function(){window.requestAnimationFrame(function(){open(m,div);});},contentDelay);};var open=function(m,div){if(!isOpen){var content=m.querySelector('.modal__content');m.classList.add('modal--active');content.classList.add('modal__content--active');if($('body').hasClass('mobile')){modals.on('focus','input',function(){dialog.addClass('key-on');}).on('blur','input',function(){dialog.removeClass('key-on');});}content.addEventListener('transitionend',hideDiv,false);isOpen=true;window.setTimeout(function(){modals.siblings('div, header, footer, main').addClass('blurred');},50);}function hideDiv(){div.style.opacity='0';content.removeEventListener('transitionend',hideDiv,false);}};var close=function(event){event.preventDefault();event.stopImmediatePropagation();var target=event.target;var div=document.getElementById('modal__temp');modals.siblings().removeClass('blurred');if(isOpen&&target.classList.contains('modal__bg')||target.classList.contains('close-btn')){div.style.opacity='1';div.removeAttribute('style');modals.removeClass('modal--active');content.removeClass('modal__content--active');trigger.css('transform','none').removeClass('modal__trigger--active');div.addEventListener('transitionend',removeDiv,false);isOpen=false;}function removeDiv(){setTimeout(function(){window.requestAnimationFrame(function(){div.remove();});},contentDelay-50);}};var bindActions=function(){trigger.on('click',getId);closers.on('click',close);modalsbg.on('click',close);};var init=function(){bindActions();};return{init:init};}());Modal.init();